<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Discussion of Various Joins in `{peacesciencer}` • peacesciencer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="A Discussion of Various Joins in `{peacesciencer}`">
<meta property="og:description" content="peacesciencer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">peacesciencer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.9999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">What’s Included?</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/coerce-dispute-year-dyad-year.html">How `{peacesciencer}` Coerces Dispute-Year Data into Dyad-Year Data</a>
    </li>
    <li>
      <a href="../articles/create-different-kinds-of-data-in-peacesciencer.html">Create Different Kinds of Data in `{peacesciencer}`</a>
    </li>
    <li>
      <a href="../articles/democracy.html">Fixing Unnecessary Missingness in Democracy Scores in `{peacesciencer}`</a>
    </li>
    <li>
      <a href="../articles/joins.html">A Discussion of Various Joins in `{peacesciencer}`</a>
    </li>
    <li>
      <a href="../articles/parlor-tricks.html">Various Parlor Tricks in `{peacesciencer}`</a>
    </li>
    <li>
      <a href="../articles/state-systems.html">A Discussion of Correlates of War and Gleditsch-Ward Systems and `{peacesciencer}`</a>
    </li>
    <li>
      <a href="../articles/times.html">Run Times (and Tips) for Various Functions in `{peacesciencer}`</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    User Guide
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../ms.html">HTML</a>
    </li>
    <li>
      <a href="../ms.pdf">PDF</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/svmiller/peacesciencer/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="joins_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A Discussion of Various Joins in <code>{peacesciencer}</code>
</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/svmiller/peacesciencer/blob/master/vignettes/joins.Rmd"><code>vignettes/joins.Rmd</code></a></small>
      <div class="hidden name"><code>joins.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<p>Users who may wish to improve their own data management skills in R by looking how <a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a> functions are written will see that basic foundation of <a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a>’s functions are so-called “join” functions. The “join” functions themselves come in <a href="https://dplyr.tidyverse.org">dplyr</a>, a critical dependency for <a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a> and the effective engine of <a href="https://www.tidyverse.org"><code>{tidyverse}</code></a> (which I suggest for a basic workflow tool, and which the user may already be using). Users who have absolutely no idea what these functions are welcome to find more thorough texts about these different types of joins. Their functionality and terminology have <a href="https://www.w3schools.com/sql/sql_join.asp">a clear basis in SQL</a>, a relational database management system that first appeared in 1974 for data management and data manipulation. My goal here is not to offer a crash course on all these potential “join” functions, though helpful <a href="https://github.com/gadenbuie/tidyexplain">visual primers are available in R</a> and <a href="https://blog.codinghorror.com/a-visual-explanation-of-sql-joins/">SQL</a>. Instead, I will offer the basic principles these visual primers are communicating as they apply to <a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a>.</p>
<div id="left-outer-join" class="section level2">
<h2 class="hasAnchor">
<a href="#left-outer-join" class="anchor"></a>Left (Outer) Join</h2>
<p>The first type of join is the most important type of join function in <a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a>. Indeed, almost every function in this package that deals with adding variables to a type of data created in <a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a> includes it. This is the “left join” (<code>left_join()</code> in <a href="https://dplyr.tidyverse.org">dplyr</a>), alternatively known as <a href="https://www.w3schools.com/sql/sql_join_left.asp">the “outer join” or “left outer join” in the SQL context</a>, and is a type of “mutating join” in the <a href="https://tidyverse.tidyverse.org">tidyverse</a> context. In plain English, the <code>left_join()</code> assumes two data objects—a “left” object (<code>x</code>) and a “right” object (<code>y</code>)—and returns all rows from the left object (<code>x</code>) with matching information in the right object (<code>y</code>) by a set of common matching keys (or columns in both <code>x</code> and <code>y</code>).</p>
<p>Here is a simple example of how this works in the <a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a> context. Assume a simple state-year data set of the United States (<code>ccode: 2</code>), Canada (<code>ccode: 20</code>), and the United Kingdom (<code>ccode: 200</code>) for all years from 2016 to 2020. Recreating this simple kind of data is no problem in R and will serve as our “left object” (<code>x</code>) for this simple example.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tibble</span><span class="op">(</span>ccode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">20</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># rowwise() is a great trick for nesting sequences in tibbles</span>
  <span class="co"># This parlor trick, for example, generates state-year data out of raw state data in create_stateyears()</span>
  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># create a sequence as a nested column</span>
  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2016</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># unnest the column</span>
  <span class="fu">unnest</span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">x</span>

<span class="va">x</span>
<span class="co">#&gt; # A tibble: 15 × 2</span>
<span class="co">#&gt;    ccode  year</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1     2  2016</span>
<span class="co">#&gt;  2     2  2017</span>
<span class="co">#&gt;  3     2  2018</span>
<span class="co">#&gt;  4     2  2019</span>
<span class="co">#&gt;  5     2  2020</span>
<span class="co">#&gt;  6    20  2016</span>
<span class="co">#&gt;  7    20  2017</span>
<span class="co">#&gt;  8    20  2018</span>
<span class="co">#&gt;  9    20  2019</span>
<span class="co">#&gt; 10    20  2020</span>
<span class="co">#&gt; 11   200  2016</span>
<span class="co">#&gt; 12   200  2017</span>
<span class="co">#&gt; 13   200  2018</span>
<span class="co">#&gt; 14   200  2019</span>
<span class="co">#&gt; 15   200  2020</span></code></pre></div>
<p>Let’s assume we’re building toward the kind of state-year analysis I describe in <a href="http://svmiller.com/peacesciencer/ms.pdf">the manuscript accompanying this package</a>. For example, the canonical civil conflict analysis by <a href="https://www.cambridge.org/core/journals/american-political-science-review/article/abs/ethnicity-insurgency-and-civil-war/B1D5D0E7C782483C5D7E102A61AD6605">Fearon and Laitin (2003)</a> has an outcome that varies by year, but several independent variables that are time-invariant and serve as variables for making state-to-state comparisons in their model of civil war onset (e.g ethnic fractionalization, religious fractionalization, terrain ruggedness). In a similar manner, we have a basic ranking of the United States, Canada, and the United Kingdom in our case. Minimally, the United States scores “low”, Canada scores “medium”, and the United Kingdom scores “high” on some metric. There is no variation by time in this simple example.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tibble</span><span class="op">(</span>ccode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">20</span>, <span class="fl">200</span><span class="op">)</span>,
       ranking <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"medium"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">y</span>

<span class="va">y</span>
<span class="co">#&gt; # A tibble: 3 × 2</span>
<span class="co">#&gt;   ccode ranking</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; 1     2 low    </span>
<span class="co">#&gt; 2    20 medium </span>
<span class="co">#&gt; 3   200 high</span></code></pre></div>
<p>This is the “right object” (<code>y</code>) that we want to add to the “left object” that serves as our main data frame. Notice that <code>x</code> has no variable for the ranking information we want. It does, however, have matching observations for the state identifiers corresponding with the Correlates of War state codes for the U.S., Canada, and the United Kingdom. The left join (as <code>left_join()</code>) merges <code>y</code> into <code>x</code>, returning all rows of <code>x</code> with matching information in <code>y</code> based on columns they share in common (here: <code>ccode</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alternatively, as I tend to do it: x %&gt;% left_join(., y)</span>
<span class="fu">left_join</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "ccode"</span>
<span class="co">#&gt; # A tibble: 15 × 3</span>
<span class="co">#&gt;    ccode  year ranking</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;  </span>
<span class="co">#&gt;  1     2  2016 low    </span>
<span class="co">#&gt;  2     2  2017 low    </span>
<span class="co">#&gt;  3     2  2018 low    </span>
<span class="co">#&gt;  4     2  2019 low    </span>
<span class="co">#&gt;  5     2  2020 low    </span>
<span class="co">#&gt;  6    20  2016 medium </span>
<span class="co">#&gt;  7    20  2017 medium </span>
<span class="co">#&gt;  8    20  2018 medium </span>
<span class="co">#&gt;  9    20  2019 medium </span>
<span class="co">#&gt; 10    20  2020 medium </span>
<span class="co">#&gt; 11   200  2016 high   </span>
<span class="co">#&gt; 12   200  2017 high   </span>
<span class="co">#&gt; 13   200  2018 high   </span>
<span class="co">#&gt; 14   200  2019 high   </span>
<span class="co">#&gt; 15   200  2020 high</span></code></pre></div>
<p>This is obviously a very simple example, but it scales well even if there is some additional complexity. For example, let’s assume we added a simple five-year panel of Australia (<code>ccode: 900</code>) to the “left object” (<code>x</code>). However, we have no corresponding information about Australia in the “right object” (<code>y</code>). Here is what the left join would produce under these circumstances.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tibble</span><span class="op">(</span>ccode <span class="op">=</span> <span class="fl">900</span>,
       year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2016</span><span class="op">:</span><span class="fl">2020</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">x</span>, <span class="va">.</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">x</span>

<span class="va">x</span>
<span class="co">#&gt; # A tibble: 20 × 2</span>
<span class="co">#&gt;    ccode  year</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1     2  2016</span>
<span class="co">#&gt;  2     2  2017</span>
<span class="co">#&gt;  3     2  2018</span>
<span class="co">#&gt;  4     2  2019</span>
<span class="co">#&gt;  5     2  2020</span>
<span class="co">#&gt;  6    20  2016</span>
<span class="co">#&gt;  7    20  2017</span>
<span class="co">#&gt;  8    20  2018</span>
<span class="co">#&gt;  9    20  2019</span>
<span class="co">#&gt; 10    20  2020</span>
<span class="co">#&gt; 11   200  2016</span>
<span class="co">#&gt; 12   200  2017</span>
<span class="co">#&gt; 13   200  2018</span>
<span class="co">#&gt; 14   200  2019</span>
<span class="co">#&gt; 15   200  2020</span>
<span class="co">#&gt; 16   900  2016</span>
<span class="co">#&gt; 17   900  2017</span>
<span class="co">#&gt; 18   900  2018</span>
<span class="co">#&gt; 19   900  2019</span>
<span class="co">#&gt; 20   900  2020</span>

<span class="fu">left_join</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "ccode"</span>
<span class="co">#&gt; # A tibble: 20 × 3</span>
<span class="co">#&gt;    ccode  year ranking</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;  </span>
<span class="co">#&gt;  1     2  2016 low    </span>
<span class="co">#&gt;  2     2  2017 low    </span>
<span class="co">#&gt;  3     2  2018 low    </span>
<span class="co">#&gt;  4     2  2019 low    </span>
<span class="co">#&gt;  5     2  2020 low    </span>
<span class="co">#&gt;  6    20  2016 medium </span>
<span class="co">#&gt;  7    20  2017 medium </span>
<span class="co">#&gt;  8    20  2018 medium </span>
<span class="co">#&gt;  9    20  2019 medium </span>
<span class="co">#&gt; 10    20  2020 medium </span>
<span class="co">#&gt; 11   200  2016 high   </span>
<span class="co">#&gt; 12   200  2017 high   </span>
<span class="co">#&gt; 13   200  2018 high   </span>
<span class="co">#&gt; 14   200  2019 high   </span>
<span class="co">#&gt; 15   200  2020 high   </span>
<span class="co">#&gt; 16   900  2016 &lt;NA&gt;   </span>
<span class="co">#&gt; 17   900  2017 &lt;NA&gt;   </span>
<span class="co">#&gt; 18   900  2018 &lt;NA&gt;   </span>
<span class="co">#&gt; 19   900  2019 &lt;NA&gt;   </span>
<span class="co">#&gt; 20   900  2020 &lt;NA&gt;</span></code></pre></div>
<p>Because have no ranking for Australia in this simple example, the left join returns NAs for Australia. The original dimensions of <code>x</code> under these conditions is unaffected.</p>
<p>What would happen if we had an observation in <code>y</code> that has no corresponding match in <code>x</code>? For example, let’s assume our ranking data also included a ranking for Denmark (<code>ccode: 390</code>), though Denmark does not appear in <code>x</code>. Here is what would happen under these circumstances.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tibble</span><span class="op">(</span>ccode <span class="op">=</span> <span class="fl">390</span>,
       ranking <span class="op">=</span> <span class="st">"high"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">y</span>, <span class="va">.</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">y</span>

<span class="va">y</span>
<span class="co">#&gt; # A tibble: 4 × 2</span>
<span class="co">#&gt;   ccode ranking</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; 1     2 low    </span>
<span class="co">#&gt; 2    20 medium </span>
<span class="co">#&gt; 3   200 high   </span>
<span class="co">#&gt; 4   390 high</span>

<span class="fu">left_join</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "ccode"</span>
<span class="co">#&gt; # A tibble: 20 × 3</span>
<span class="co">#&gt;    ccode  year ranking</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;  </span>
<span class="co">#&gt;  1     2  2016 low    </span>
<span class="co">#&gt;  2     2  2017 low    </span>
<span class="co">#&gt;  3     2  2018 low    </span>
<span class="co">#&gt;  4     2  2019 low    </span>
<span class="co">#&gt;  5     2  2020 low    </span>
<span class="co">#&gt;  6    20  2016 medium </span>
<span class="co">#&gt;  7    20  2017 medium </span>
<span class="co">#&gt;  8    20  2018 medium </span>
<span class="co">#&gt;  9    20  2019 medium </span>
<span class="co">#&gt; 10    20  2020 medium </span>
<span class="co">#&gt; 11   200  2016 high   </span>
<span class="co">#&gt; 12   200  2017 high   </span>
<span class="co">#&gt; 13   200  2018 high   </span>
<span class="co">#&gt; 14   200  2019 high   </span>
<span class="co">#&gt; 15   200  2020 high   </span>
<span class="co">#&gt; 16   900  2016 &lt;NA&gt;   </span>
<span class="co">#&gt; 17   900  2017 &lt;NA&gt;   </span>
<span class="co">#&gt; 18   900  2018 &lt;NA&gt;   </span>
<span class="co">#&gt; 19   900  2019 &lt;NA&gt;   </span>
<span class="co">#&gt; 20   900  2020 &lt;NA&gt;</span></code></pre></div>
<p>Notice the output of this left join is identical to the output above. Australia is in <code>x</code>, but not in <code>y</code>. Thus, the rows for Australia are returned but the absence of ranking information for Australia in <code>y</code> means the variable is <code>NA</code> for Australia after the merge. Denmark is in <code>y</code>, but not <code>x</code>. Because the left join returns all rows in <code>x</code> with matching information in <code>y</code>, the absence of observations for Denmark in <code>x</code> means there is nowhere for the ranking information to go in the merge. Thus, Denmark’s ranking is effectively ignored.</p>
<div id="why-the-left-join-in-particular" class="section level3">
<h3 class="hasAnchor">
<a href="#why-the-left-join-in-particular" class="anchor"></a>Why the Left Join, in Particular?</h3>
<p>An interested user may ask what’s so special about this kind of join that it appears everywhere in <a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a>? One is a matter of taste. I could just as well be doing this explainer piece by reference to the “right join”, the mirror join to “left join.” The right join in <a href="https://dplyr.tidyverse.org">dplyr</a>’s <code>right_join(x,y)</code> returns all records from <code>y</code> with matching rows in <code>x</code> by common columns. However, I tend to <a href="http://svmiller.com/blog/2021/01/a-tutorial-on-the-join-family-in-r/#myadvice">think “left-handed”</a> when it comes to data management and instruct my students to do the same when I introduce them to data transformation in R. I like the intuition, especially in the pipe-based workflow, to start with a master data object at the top of the pipe and keep it “left” as I add information to it. This approach to data transformation and it recurs in <a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a> as a result.</p>
<p>Beyond that matter of taste, the left join is everywhere in <a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a> because the project endeavors hard to recreate the appropriate universe of cases of interest to the user and allow the user to add stuff to it as they see fit. <code><a href="../reference/create_stateyears.html">create_stateyears()</a></code> will create the entire universe of state-years from 1816 to the present for a state-year analysis. <code><a href="../reference/create_dyadyears.html">create_dyadyears()</a></code> will create the entire universe of dyad-years from 1816 to the present for a dyad-year analysis. The logic here, as it is implemented in <a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a>’s multiple functions, is the type of data the user wants to create has been created for them. The user does not want to expand the data any further than that, though the user may want to do something like reduce the full universe of 1816-2020 state-years to just 1946-2010. However, this is a universe discarded, not a universe that has been augmented or expanded.</p>
<p>With that in mind, every function’s user of the left join assumes the data object it receives represents the full universe of cases of interest to the researcher. The left join is just adding information to it, based on matching information in one of its many data sets. When done carefully, the left join is a dutiful way of adding information to a data set without changing the number of rows of the original data set. The number of columns will obviously expand, but the number of rows is unaffected.</p>
</div>
<div id="potential-problems-of-the-left-join" class="section level3">
<h3 class="hasAnchor">
<a href="#potential-problems-of-the-left-join" class="anchor"></a>Potential Problems of the Left Join</h3>
<p>“When done carefully” is doing some heavy-lifting in that last sentence. So, let me explain some situations where the left join will produce problems for the researcher (even if the join itself is doing what it is supposed to do from an operational standpoint).</p>
<p>The first is less of a problem, at least as I have implemented in <a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a>, but more of a caution. In the above example, our panel consists of just the U.S., Canada, the United Kingdom, and Australia. We happen to have a ranking for Denmark, but Denmark wasn’t in our panel. Therefore, no row is created for Denmark. If it were that important that the left join create those rows for Denmark, we should’ve had it in the first place. In this case, the left join is behaving as it should. We should’ve had Denmark in the panel before trying to match information to it.</p>
<p><a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a> circumvents this issue by creating universal data (e.g. all state-years, all dyad-years, all available leader-years) that the user is free to subset as they see fit. Users should run one of the “create” functions (e.g. <code><a href="../reference/create_stateyears.html">create_stateyears()</a></code>, <code><a href="../reference/create_dyadyears.html">create_dyadyears()</a></code>) at the top of their script before adding information to it because the left join, as implemented everywhere in this package, is building in an assumption that the universe of cases of interest to the user is represented in the “left object” for a left outer join. Basically, do not expect the left join to create new rows in <code>x</code> in a situation where there is a state represented in <code>y</code> but not in <code>x</code>. It will not. This type of join assumes the universe of cases of interest to the researcher already appear in the “left object.”</p>
<p>The second situation is a bigger problem. Sometimes, often when <a href="http://svmiller.com/peacesciencer/articles/state-systems.html">bouncing between information denominated in Correlates of War states and Gleditsch-Ward states</a>, there is an unwanted duplicate observation in the data frame to be merged into the primary data of interest to the user. Let’s go back to our simple example of <code>x</code> and <code>y</code> here. Everything here performs nicely, though Australia (in <code>x</code>) has no ranking and Denmark (in <code>y</code>) is not in our panel of state-years because it wasn’t part of the original universe of cases of interest to us.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span>
<span class="co">#&gt; # A tibble: 20 × 2</span>
<span class="co">#&gt;    ccode  year</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1     2  2016</span>
<span class="co">#&gt;  2     2  2017</span>
<span class="co">#&gt;  3     2  2018</span>
<span class="co">#&gt;  4     2  2019</span>
<span class="co">#&gt;  5     2  2020</span>
<span class="co">#&gt;  6    20  2016</span>
<span class="co">#&gt;  7    20  2017</span>
<span class="co">#&gt;  8    20  2018</span>
<span class="co">#&gt;  9    20  2019</span>
<span class="co">#&gt; 10    20  2020</span>
<span class="co">#&gt; 11   200  2016</span>
<span class="co">#&gt; 12   200  2017</span>
<span class="co">#&gt; 13   200  2018</span>
<span class="co">#&gt; 14   200  2019</span>
<span class="co">#&gt; 15   200  2020</span>
<span class="co">#&gt; 16   900  2016</span>
<span class="co">#&gt; 17   900  2017</span>
<span class="co">#&gt; 18   900  2018</span>
<span class="co">#&gt; 19   900  2019</span>
<span class="co">#&gt; 20   900  2020</span>
<span class="va">y</span>
<span class="co">#&gt; # A tibble: 4 × 2</span>
<span class="co">#&gt;   ccode ranking</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; 1     2 low    </span>
<span class="co">#&gt; 2    20 medium </span>
<span class="co">#&gt; 3   200 high   </span>
<span class="co">#&gt; 4   390 high</span></code></pre></div>
<p>Let’s assume, however, we mistakenly entered the United Kingdom twice into <code>y</code>. We know these data are supposed to be simple state-level rankings. Each state is supposed to be in there just once. The United Kingdom appears in there twice.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tibble</span><span class="op">(</span>ccode <span class="op">=</span> <span class="fl">200</span>,
       ranking <span class="op">=</span> <span class="st">"high"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">y</span>, <span class="va">.</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">y2</span></code></pre></div>
<p>If we were to left join <code>y2</code> into <code>x</code>, we get an unwelcome result. The United Kingdom is duplicated for all yearly observations.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">left_join</span><span class="op">(</span><span class="va">x</span>, <span class="va">y2</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">data.frame</span>
<span class="co">#&gt; Joining, by = "ccode"</span>
<span class="co">#&gt;    ccode year ranking</span>
<span class="co">#&gt; 1      2 2016     low</span>
<span class="co">#&gt; 2      2 2017     low</span>
<span class="co">#&gt; 3      2 2018     low</span>
<span class="co">#&gt; 4      2 2019     low</span>
<span class="co">#&gt; 5      2 2020     low</span>
<span class="co">#&gt; 6     20 2016  medium</span>
<span class="co">#&gt; 7     20 2017  medium</span>
<span class="co">#&gt; 8     20 2018  medium</span>
<span class="co">#&gt; 9     20 2019  medium</span>
<span class="co">#&gt; 10    20 2020  medium</span>
<span class="co">#&gt; 11   200 2016    high</span>
<span class="co">#&gt; 12   200 2016    high</span>
<span class="co">#&gt; 13   200 2017    high</span>
<span class="co">#&gt; 14   200 2017    high</span>
<span class="co">#&gt; 15   200 2018    high</span>
<span class="co">#&gt; 16   200 2018    high</span>
<span class="co">#&gt; 17   200 2019    high</span>
<span class="co">#&gt; 18   200 2019    high</span>
<span class="co">#&gt; 19   200 2020    high</span>
<span class="co">#&gt; 20   200 2020    high</span>
<span class="co">#&gt; 21   900 2016    &lt;NA&gt;</span>
<span class="co">#&gt; 22   900 2017    &lt;NA&gt;</span>
<span class="co">#&gt; 23   900 2018    &lt;NA&gt;</span>
<span class="co">#&gt; 24   900 2019    &lt;NA&gt;</span>
<span class="co">#&gt; 25   900 2020    &lt;NA&gt;</span></code></pre></div>
<p>It doesn’t matter that the duplicate ranking in <code>y2</code> for the UK was the same. It would be messier, sure, if the ranking was different for the duplicate observation, but it matters more here that it was duplicated. In a panel like this, a user who is not careful will have the effect of overweighting those observations that duplicate. In a simple example like this, subsetting to just complete cases (i.e. Australia has no ranking), the UK is 50% of all observations despite the fact it should just be a third of observations. That’s not ideal for a researcher.</p>
<p><a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a> goes above and beyond to make sure this doesn’t happen in the data it creates. Functions are <a href="https://github.com/svmiller/peacesciencer/blob/master/tests/testthat/test_nodamnduplicates.R">aggressively tested to make sure nothing duplicates</a>, and various parlor tricks (prominently <a href="https://dplyr.tidyverse.org/reference/group_by.html">group-by</a> <a href="https://dplyr.tidyverse.org/reference/slice.html">slices</a>) are used internally to cull those duplicate observations. The release of a function that makes prominent use of the left join is done with the assurance it doesn’t create a duplicate. No matter, this is the biggest peril of the left join for a researcher who may want to duplicate what <a href="https://github.com/svmiller/peacesciencer/">peacesciencer</a> does on their own. Always inspect the data you merge, and the output.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Steve Miller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
